<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AutoBill Dashboard</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 40px; background: #fafafa; }
      h1 { text-align: center; }
      #status { text-align: center; margin-bottom: 10px; }
      table { width: 100%; border-collapse: collapse; background: white; }
      th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: center; }
      th { background: #333; color: #fff; }
      tr:nth-child(even) { background: #f2f2f2; }
      #total { font-size: 1.2em; font-weight: bold; text-align: right; margin-top: 10px; }
    </style>
  </head>
  <body>
    <h1>AutoBill Transactions</h1>
    <div id="status">Loading...</div>
    <table>
      <thead>
        <tr>
          <th>ID</th><th>Name</th><th>Price (LKR)</th>
          <th>Qty</th><th>Payable (LKR)</th><th>Time (UTC)</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
    <div id="total"></div>

    <script>
      const API_URL =
        "https://autobill-api-ykewz.ondigitalocean.app/api/transactions?api_key=my_super_secret_key_39281";

      async function loadData() {
        try {
          const r = await fetch(API_URL);
          const list = await r.json();

          const tbody = document.getElementById("rows");
          tbody.innerHTML = list
            .map(
              r => `<tr>
                <td>${r.id}</td>
                <td>${r.name}</td>
                <td>${r.price}</td>
                <td>${r.taken}</td>
                <td>${r.payable}</td>
                <td>${r.created_at}</td>
              </tr>`
            )
            .join("");

          const total = list.reduce((sum, r) => sum + (r.payable || 0), 0);
          document.getElementById("total").textContent =
            "Total (LKR): " + total.toFixed(2);

          document.getElementById("status").textContent =
            "Last update: " + new Date().toLocaleTimeString();
        } catch (e) {
          document.getElementById("status").textContent =
            "Error loading data: " + e;
        }
      }

      loadData();                   // first load
      setInterval(loadData, 5000);  // refresh every 5 seconds
    </script>
  </body>
</html>
